//*****************************************************************************
//
// sd_dsa.c - hal for dsa function.
//
// Copyright (c) 2019-2029 SemiDrive Incorporated.  All rights reserved.
// Software License Agreement
//
//*****************************************************************************
#include <sd_dsa.h>
#include <trace.h>

#define LOCAL_TRACE 0 //close local trace 1->0

typedef enum dsa_privkey_bits_type {
    DSA_PRIV_KEY_LEN_1024_128    = 0x00U,
    DSA_PRIV_KEY_LEN_2048_256    = 0x01U,
    DSA_PRIV_KEY_LEN_2048_224    = 0x02U
} dsa_privkey_bits_type_t;

uint8_t __attribute__((aligned(CACHE_LINE))) dsa_p_gen_1024_default[128] =
                                      "\xF3\x0C\x68\xCC\xBC\xDA\x9A\x3C\x27\x1A\x2A\x2F\x84\x27\xD6\x83\xC6\xE7\x9E\x5B\x12\x1D\xED\xEC\x0F\x1C\x3A\xE5\xDA\x7D\x42\xA6"
                                      "\xEE\x32\x7D\x01\x33\x83\xBA\xF6\xF2\xCE\xCE\x5E\x6D\xC1\xCD\x63\x24\x3B\xA4\x0D\x45\x7B\xAC\xAB\xD8\x0E\x6C\xB2\x1A\x54\x90\x59"
                                      "\x0A\x4B\x8B\xC7\x9E\xCF\x2D\xBE\xA7\x5A\xAF\xF2\x75\x50\x7C\xE1\xD7\x5B\xEE\x80\x2E\x86\xE2\x98\xC2\xF8\xB0\x07\x87\xA5\x3A\x68"
                                      "\xA6\x25\xC3\x57\xE0\x8D\xAD\xCF\xCD\x45\x6F\x19\x4A\x87\x76\x9D\x3D\x91\x18\xB0\xF1\xA5\x0D\x2D\x7F\x84\x29\x1F\x05\x54\x94\xEB"; //   -- P
uint8_t __attribute__((aligned(CACHE_LINE))) dsa_q_gen_1024_default[128] =
                                      "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
                                      "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
                                      "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
                                      "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x9E\x60\x33\x7C\x7B\x00\x3F\x2F\x4C\x3B\x4D\x94\xB1\xCC\x52\x64\x9A\xCA\xDA\x4B"; //   -- Q
uint8_t __attribute__((aligned(CACHE_LINE))) dsa_g_gen_1024_default[128] = "\x9A\x2C\x52\x47\x9B\xE6\xFF\x23\xA4\xE8\xBE\xC6\x4C\x18\xF2\xA0\x0E\x1C\x86\x8D\x1C\x58\xBE\x6F\x72\x2D\x59\x47\x69\x8C\x11\x21"
                                      "\xCD\x89\x71\x41\x6F\x8E\xE1\x91\xE8\xC3\xF2\x5C\xCF\xEA\x38\xD8\x32\x36\xB8\x73\xB3\x1B\x58\x87\xCE\xCC\x03\xA2\xAB\x89\x4B\xB3"
                                      "\x42\x66\x68\x67\x70\xA7\xFF\x53\x32\x1A\x4F\x59\x98\x65\xEE\xEA\x8E\x7E\x11\x43\x97\xA5\x0C\x1D\xB5\xCA\xBB\x86\x06\xE5\x8D\xE4"
                                      "\x45\xFB\xE2\x67\x00\xC6\x82\xF3\x16\xB3\x12\xE7\x6E\x5E\xC2\xD7\x9C\xAC\xCD\xC1\x65\x69\x90\xB2\x9A\x96\x7F\x8C\xC9\x2F\xD9\xA8"; //   -- G

uint8_t __attribute__((aligned(CACHE_LINE))) dsa_p_1024_default[128] = "\xDF\x73\x85\x75\xC2\xD7\x6F\x9A\xE4\x69\xF3\x6F\xE8\x00\x8E\x97\xD8\x51\x09\xF4\x7E\xE0\xE2\xDF\x28\x39\x68\x27\x42\x82\x52\x31"
                                      "\xAB\x25\x93\xBB\xF0\x3F\xB5\xE6\x31\x8F\x63\x88\x79\xBE\xD5\x69\xF3\x83\x17\x1E\xB1\x55\x2E\xE2\x33\x43\x3E\x94\xE8\xEA\x75\x96"
                                      "\x9A\x9F\x68\x37\xE2\x2C\x8B\x8C\x53\x84\xDE\x94\xBF\x76\x74\xB6\xB7\x3B\x7C\xDC\xD6\x79\xE6\x98\x8E\x84\x0A\xC5\x7D\x89\x41\x3D"
                                      "\x55\x64\x27\x00\xDA\x46\x2A\xC5\x88\x36\x7B\x81\xBE\x5E\x83\xED\x36\xDF\xD7\xCB\x04\x6A\x8E\x7E\xC1\x4B\x6D\xE6\x00\x47\xCE\xC5"; // -- P
uint8_t __attribute__((aligned(CACHE_LINE))) dsa_q_1024_default[128] = "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
                                      "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
                                      "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
                                      "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xCA\x90\xA7\x86\x45\xE7\x0A\xA3\x22\xB3\xE9\x5F\xA8\x2D\x17\x56\xF2\x22\x09\x13"; // -- Q
uint8_t __attribute__((aligned(CACHE_LINE))) dsa_g_1024_default[128] = "\x64\xBC\xA3\xA4\x4D\x74\x61\x47\xA2\x82\x78\xB2\xB7\xDB\x24\xE0\x1A\x8E\x07\x66\x03\xBA\x45\xBF\x35\x96\x7E\xED\x7C\x00\xAD\xDC"
                                      "\x03\xB1\xAF\xF5\x21\xC2\x37\x94\x1A\x60\xE2\x3F\x21\x23\x6B\x16\xE2\x40\xC7\x16\x5D\x4E\x01\x45\x8E\x22\x90\x74\xC9\xC0\x3D\x6D"
                                      "\x9F\xBA\xEB\x9C\xFE\xE8\x72\x86\xB9\x85\x29\xC7\x66\xEC\x88\xC1\x3E\x51\x40\x4D\xA7\xF8\xE1\xE5\x55\x15\xD3\x10\xC2\xD7\x1C\xC0"
                                      "\x9B\x76\xB1\x5C\x36\x08\xF1\xFE\x36\x2E\x74\x6C\x13\x9C\x6E\xCD\x91\x0F\xB5\x5E\xA3\xDA\xEB\x7D\xC6\xF6\x27\x62\xD5\x89\x6F\x4A"; // -- G

uint8_t __attribute__((aligned(CACHE_LINE))) dsa_p_2048_256_default[256] =
                                      "\xD9\x32\xDF\x73\xA3\x25\x69\x24\x2C\x11\xA7\x25\x4D\xC4\xC8\xF7\xDF\x2A\x30\xF0\x51\x95\x44\x64\x39\xFE\xCC\xF4\x88\x9A\x13\x9B"
                                      "\x47\x31\x9F\x1B\xAD\x4E\x59\x39\x62\x0A\x34\x6F\x16\x27\x85\xC1\x02\xF6\x99\xF4\xC9\xFE\xB4\x20\x84\x1B\xCD\x99\xB8\x18\x0B\x2B"
                                      "\x36\x56\x8D\xED\x35\xE3\xB6\x52\x36\x0B\xE1\xFD\xF6\x6B\x4E\x08\xEF\x86\x62\xB8\xF2\x0E\xA0\x1D\x50\xEC\x0C\xBF\xB4\xAC\x73\xED"
                                      "\x6E\xE1\xB7\xEE\x2F\xCB\x6D\x36\x7C\x14\x86\xDB\xEE\xEA\xEA\x21\x5C\xCE\x6C\xEE\xBC\x4C\xD4\x39\x34\x1E\x96\xE8\x61\x0B\x60\x56"
                                      "\xFB\xB9\x5E\x49\x20\xF3\x7E\xF4\xF9\xFB\x95\x8D\x4C\xF5\xEE\x1F\x9B\xBA\x03\x0F\x3D\xD2\xA7\xC0\x5A\x69\x5C\xDF\x0C\x26\x27\x2E"
                                      "\xCA\x51\x79\x9A\x6B\x49\xB3\xFA\x43\x78\xA3\xB3\xDB\x0B\x9B\xD4\x88\x20\x20\xB1\x64\xA2\x78\xB5\x7F\x99\x00\xEF\x09\xAC\x8F\x6B"
                                      "\x0E\x03\xD5\xDA\x07\xFD\x5F\x3B\xB3\x70\xED\x6D\xAA\x23\x80\x4B\x30\x49\x47\xED\x41\x6A\x06\x0A\xD4\x28\x20\x04\x7D\xC4\xD6\x42"
                                      "\xFA\x1B\x36\x76\xD4\x1D\xB9\xBA\xCF\x2C\x26\xD3\x37\x19\x57\x4E\x01\x85\x9F\x6A\xA9\xE0\x0D\xAC\x6A\x9E\x70\x83\x13\x1C\x5E\x3D"; // -- P
uint8_t __attribute__((aligned(CACHE_LINE))) dsa_q_2048_256_default[256] =
                                      "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
                                      "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
                                      "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
                                      "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
                                      "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
                                      "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
                                      "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
                                      "\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xCB\x52\xCA\xFE\x68\x10\x7F\x9E\x00\xD9\x6F\x15\xB3\xC7\x7F\x86\x03\x81\xA9\x0F"; // -- Q
uint8_t __attribute__((aligned(CACHE_LINE))) dsa_g_2048_256_default[256] =
                                      "\x20\xC2\x36\xA6\x02\x02\x70\x3F\x85\xE1\x7C\x60\xDD\x60\xCE\x80\x3E\x05\xE4\x99\x5F\xC0\xA5\x0C\xB2\x0E\xC9\xFE\xE1\xD2\x6A\x04"
                                      "\x12\x59\x1F\x10\xDE\xCC\x6B\xE4\x54\x25\x3C\xA8\x0A\xF1\x21\x6A\x6A\xA3\x8B\x75\xEA\x00\xA7\xC9\x8E\xF8\x7B\x8A\xB4\x91\xD3\x9C"
                                      "\x14\xDD\xBC\x0F\x00\xBB\x52\x8A\x4C\xBF\xE1\x7D\xEF\x47\xC1\x6F\x5F\xFE\x46\x98\xEE\xC5\xD2\x9C\x49\x5E\xF6\xCF\x8C\x0F\xD7\x2F"
                                      "\x7F\x5F\x38\x08\x32\x9B\x4F\x39\x2B\x2B\x77\xB6\x94\xB3\xEA\xA0\xF2\xE1\xA2\x63\x99\x08\xBF\x67\xE8\x17\x61\x27\xB5\x20\x64\x1D"
                                      "\x46\xAA\x65\x8D\x15\xA0\x72\xBE\x0C\x56\x17\xA5\x24\xA8\xE4\x58\x43\x9B\x0C\x54\x07\x1C\x5B\x77\x06\xEB\x79\x2F\xED\x93\xC6\x7D"
                                      "\xF8\x83\x63\x6C\xB9\x9F\xA1\x78\x77\xE5\x26\xD8\xD2\x1E\x89\xD2\x36\x0C\x66\xFD\xF7\x84\xBC\x48\x6A\xAE\xF1\xFB\x4D\x93\x55\xC7"
                                      "\x1A\x99\xE3\x24\x42\xEE\x8A\x89\xFE\xB0\x10\x13\x43\x3F\xA6\xCE\xC7\xDD\x61\x49\x41\x8E\x5C\x72\xC0\xFC\xA3\x6C\x61\x49\xDD\xDC"
                                      "\x7D\x98\xE4\xF9\x1C\xFE\xD7\x51\x88\x6D\xC9\xC0\xFF\xA0\xF6\x78\xC2\xDD\xEE\x54\x1C\x21\xB2\x20\x51\x93\x8D\x0B\x91\x0A\xFA\x5F"; // -- G

uint8_t __attribute__((aligned(CACHE_LINE))) dsa_p_2048_224_default[256] =
                                      "\xB0\x56\xCE\xCE\x82\x71\x1D\xD6\x0E\x5A\x26\x62\x44\x98\x0D\x91\x5B\x08\x6C\x6F\xB3\xBE\xD1\x91\xAD\x9F\x1B\x9C\x4C\xA0\x7C\xD7"
                                      "\xA6\x69\xB6\xD8\xDE\x13\x74\xB5\x06\xD5\x85\x5E\x49\xB5\x9F\x24\x7D\xD3\x9E\xBC\xF2\x4F\x36\xD4\x43\x8E\x8A\x04\x4D\x58\xEB\xF1"
                                      "\x29\xBD\xD6\x54\x63\x9D\x61\xEA\xFC\x31\x87\xAC\x71\x48\x5A\xBC\xDF\xBB\xAD\xA1\xF1\x16\xD2\xD2\x8B\x77\x5A\xE0\xCA\x30\xA3\x1F"
                                      "\x9A\x93\x69\x44\xAF\x4B\xD9\xD1\x0B\xB2\xB5\xAE\x3A\xD8\xD9\x26\x61\xE8\xAC\xA4\x79\x0E\x8F\x1E\xAD\x6C\xB7\x3A\xBD\xC2\x4A\x80"
                                      "\xDE\x2F\xAA\xA3\x25\x74\x2D\x17\x4E\x0A\xB6\xB2\xB5\x6E\xD1\x00\x8E\x60\xA7\x60\x0F\x2E\xCC\xE2\x7B\x5F\x1A\xCB\x3D\xD0\x6B\x8F"
                                      "\x57\xE4\x77\xC4\xA7\xA6\x74\x7F\x1F\x55\xF1\x21\x5E\x5A\x8E\xAD\x9D\x0B\x0A\xEA\x7A\x01\x8E\xB8\x30\xA7\x03\x4C\x0C\xFC\xC5\x3A"
                                      "\x41\x4E\xFA\x55\xCB\xBB\x46\x87\x0A\xE0\xF7\xBC\xDB\x12\x9B\x76\x3C\x41\xDA\xF1\x43\x53\x3B\x4E\x5F\x48\xF6\x21\x33\x9E\x0B\x72"
                                      "\xAB\x89\x3B\x95\x5C\xC9\xBE\x34\xE1\x1D\x86\xD3\x10\x9F\x77\x68\x75\x41\xE5\x34\x95\x9B\x4B\x6F\x4A\x86\x0A\xE9\x5A\xAD\x78\x09"; // -- P
uint8_t __attribute__((aligned(CACHE_LINE))) dsa_q_2048_224_default[256] =
                                      "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
                                      "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
                                      "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
                                      "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
                                      "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
                                      "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
                                      "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
                                      "\x00\x00\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00\xCD\xFE\x37\x79\x0E\xE4\xFE\xB6\xF5\x78\xAF\x69\x92\x56\xDD\x08\xE6\xA0\xA6\x4F"; // -- Q
uint8_t __attribute__((aligned(CACHE_LINE))) dsa_g_2048_224_default[256] =
                                      "\x43\x26\x25\xDF\xF2\x30\xB8\xB8\xA0\x76\x0D\xA4\x19\x9B\xD6\x61\x1E\xD4\x6D\x30\xD5\x8B\xC4\x94\xD2\xDA\xED\x1A\x76\x0D\xBB\xD8"
                                      "\x9D\x91\x0B\x46\x46\xD8\xCA\x90\xCE\x80\x12\x73\xEE\x49\x50\xAC\xAF\xE5\xE9\xAF\x86\x7A\x78\x69\xE5\x5B\xC0\x65\x27\x56\x9A\x66"
                                      "\x8E\x5E\xFA\xF6\xD3\x51\x31\x6D\x2B\x4F\xCE\xD3\xDF\xA0\xC3\x73\x5B\x8B\xA6\x69\x05\x60\x5A\xCD\x2B\xC1\xF0\xBF\xC3\xB2\x06\x6B"
                                      "\x49\xE5\xD5\x4E\x4B\x7C\x78\xB5\xB0\xD3\x75\xE8\xFC\xA4\x17\x8A\xE3\xC0\x48\x12\xFA\xB2\x92\x9C\xF4\x8D\xDC\xAB\x94\x2B\x27\xEA"
                                      "\xF3\x1A\xB2\x49\xED\x9C\xAE\xB3\xD4\xF8\x6B\x13\x72\xF8\xE9\x54\xA5\x53\x97\x1B\x6D\x34\x2A\x7F\x3E\x5A\xF2\x3B\x62\x64\x7C\xD3"
                                      "\x15\xBD\xB2\xEF\x92\x20\x3F\x27\xD3\xAE\xD3\x22\x6B\x54\x97\xEA\x6D\x70\xC1\xEE\x19\xC1\xCB\x0F\xB5\xFA\xB3\x0D\x84\x80\xB5\xC8"
                                      "\x40\x09\xC4\xBD\x05\xD0\xB8\x6E\x43\x81\xB0\x62\x6B\xC9\xDF\x1C\xB7\x5E\xE6\xCE\x76\x55\x1C\xA1\xDE\x5B\xFC\x75\x2D\x9F\x90\xD0"
                                      "\x36\x56\xD6\x5D\x14\xB9\x82\x48\x3E\xB8\x0C\xCF\x3F\xAE\x24\x2C\xC4\x7B\x07\xC2\x42\x6C\x49\xCD\x29\x11\x1C\x83\x0C\x73\x9C\xAC"; // -- G

//*****************************************************************************
//
//! hal_dsa_init.
//!
//! @param handle input, opration handle for uplayer,creat by hal_crypto_creat_handle
//! @param priv_key_bits input, priv key bit value, to init dsa p q g value
//!
//! This function is for dsa init
//!
//! @return crypto_status_t
//
//*****************************************************************************
crypto_status_t hal_dsa_init(void* handle, int priv_key_bits)
{
    buff_addr_type_t addr_type = HAL_EXT_MEM;
    crypto_status_t ret = CRYPTO_SUCCESS;
    crypto_instance_t* l_cryptoinstance = NULL;

    if (handle == NULL) {
        ret = CRYPTO_ERROR;
    }
    else {
        l_cryptoinstance = (crypto_instance_t*)handle;

        /*do ce init and enable here*/
        if (priv_key_bits == DSA_PRIV_KEY_LEN_1024_128) {
            l_cryptoinstance->dsa_p = block_t_convert(dsa_p_gen_1024_default, 128, addr_type);
            l_cryptoinstance->dsa_q = block_t_convert(dsa_q_gen_1024_default, 128, addr_type);
            l_cryptoinstance->dsa_g = block_t_convert(dsa_g_gen_1024_default, 128, addr_type);
        }
        else if (priv_key_bits == DSA_PRIV_KEY_LEN_2048_224) {
            l_cryptoinstance->dsa_p = block_t_convert(dsa_p_2048_224_default, 256, addr_type);
            l_cryptoinstance->dsa_q = block_t_convert(dsa_q_2048_224_default, 256, addr_type);
            l_cryptoinstance->dsa_g = block_t_convert(dsa_g_2048_224_default, 256, addr_type);
        }
        else if (priv_key_bits == DSA_PRIV_KEY_LEN_2048_256) {
            l_cryptoinstance->dsa_p = block_t_convert(dsa_p_2048_256_default, 256, addr_type);
            l_cryptoinstance->dsa_q = block_t_convert(dsa_q_2048_256_default, 256, addr_type);
            l_cryptoinstance->dsa_g = block_t_convert(dsa_g_2048_256_default, 256, addr_type);
        }
        else {
            ret = CRYPTO_ERROR;
        }

    }

    return ret;
}

//*****************************************************************************
//
//! hal_dsa_sign.
//!
//! @param handle input, opration handle for uplayer,creat by hal_crypto_creat_handle
//! @param hash_nid input, hash alg type, sd_hash_alg_t
//! @param in input, msg for sign
//! @param in_len input, msg len
//! @param out output, buff for sign output
//! @param out_len input, buff len
//! @param dsa_key input, dsa key
//!
//! This function is for dsa signature
//!
//! @return crypto_status_t
//
//*****************************************************************************
crypto_status_t hal_dsa_sign(void* handle, int hash_nid, const uint8_t* in, unsigned in_len, uint8_t* out,
                         unsigned out_len, const dsa_key_t* dsa_key)
{
    uint32_t vce_id;
    buff_addr_type_t addr_type = HAL_EXT_MEM;
    crypto_status_t ret = CRYPTO_SUCCESS;
    crypto_instance_t* l_cryptoinstance = NULL;

    if (handle == NULL) {
        ret = CRYPTO_ERROR;
    }
    else {
        l_cryptoinstance = (crypto_instance_t*)handle;

        /*do ce init and enable here*/

        vce_id = l_cryptoinstance->vce_id;

        if (l_cryptoinstance->dsa_method->sign) {
            ret = l_cryptoinstance->dsa_method->sign(vce_id, SD_ALG_SHA256,
                    l_cryptoinstance->dsa_p,
                    l_cryptoinstance->dsa_q,
                    l_cryptoinstance->dsa_g,
                    dsa_key->priv_key,
                    block_t_convert(in, in_len, addr_type),
                    block_t_convert(out, out_len, addr_type));
        }
    }

    return ret;

}

//*****************************************************************************
//
//! hal_dsa_verify.
//!
//! @param handle input, opration handle for uplayer,creat by hal_crypto_creat_handle
//! @param hash_nid input, hash alg type, sd_hash_alg_t
//! @param msg input, msg for verify
//! @param msg_len input, msg len
//! @param sig output, buff for verify output
//! @param sig_len input, buff len
//! @param dsa_key input, dsa key
//!
//! This function is for dsa verify
//!
//! @return crypto_status_t
//
//*****************************************************************************
crypto_status_t hal_dsa_verify(void* handle, int hash_nid, const uint8_t* msg, size_t msg_len,
                           const uint8_t* sig, size_t sig_len, const dsa_key_t* dsa_key)
{
    uint32_t vce_id;
    buff_addr_type_t addr_type = HAL_EXT_MEM;
    crypto_status_t ret = CRYPTO_SUCCESS;
    crypto_instance_t* l_cryptoinstance = NULL;

    if (handle == NULL) {
        ret = CRYPTO_ERROR;
    }
    else {
        l_cryptoinstance = (crypto_instance_t*)handle;

        /*do ce init and enable here*/

        vce_id = l_cryptoinstance->vce_id;

        if (l_cryptoinstance->dsa_method->verify) {
            ret = l_cryptoinstance->dsa_method->verify(vce_id, SD_ALG_SHA256,
                    l_cryptoinstance->dsa_p,
                    l_cryptoinstance->dsa_q,
                    l_cryptoinstance->dsa_g,
                    dsa_key->pub_key,
                    block_t_convert(msg, msg_len, addr_type),
                    block_t_convert(sig, sig_len, addr_type));
        }
    }

    return ret;
}

//*****************************************************************************
//
//! hal_dsa_keygen.
//!
//! @param handle input, opration handle for uplayer,creat by hal_crypto_creat_handle
//! @param dsa_key output, dsa key
//!
//! This function is for dsa keypair gen
//!
//! @return crypto_status_t
//
//*****************************************************************************
crypto_status_t hal_dsa_keygen(void* handle, dsa_key_t* dsakey)
{
    uint32_t vce_id;
    crypto_status_t ret = CRYPTO_SUCCESS;
    crypto_instance_t* l_cryptoinstance = NULL;

    if (handle == NULL) {
        ret = CRYPTO_ERROR;
    }
    else {
        l_cryptoinstance = (crypto_instance_t*)handle;

        /*do ce init and enable here*/

        vce_id = l_cryptoinstance->vce_id;

        if (l_cryptoinstance->dsa_method->prikey_gen) {
            ret = l_cryptoinstance->dsa_method->prikey_gen(vce_id, l_cryptoinstance->dsa_q, dsakey->priv_key);
        }

        if (l_cryptoinstance->dsa_method->pubkey_gen) {
            ret = l_cryptoinstance->dsa_method->pubkey_gen(vce_id, l_cryptoinstance->dsa_p, l_cryptoinstance->dsa_g, dsakey->priv_key, dsakey->pub_key);
        }
    }

    return ret;
}

//*****************************************************************************
//
//! hal_dsa_keygen.
//!
//! @param handle input, opration handle for uplayer,creat by hal_crypto_creat_handle
//! @param dsa_key output, dsa key
//!
//! This function is for dsa pub key gen
//!
//! @return crypto_status_t
//
//*****************************************************************************
crypto_status_t hal_dsa_generate_pub_key(void* handle, dsa_key_t* dsakey)
{
    uint32_t vce_id;
    crypto_status_t ret = CRYPTO_SUCCESS;
    crypto_instance_t* l_cryptoinstance = NULL;

    if (handle == NULL) {
        ret = CRYPTO_ERROR;
    }
    else {
        l_cryptoinstance = (crypto_instance_t*)handle;

        /*do ce init and enable here*/

        vce_id = l_cryptoinstance->vce_id;

        if (l_cryptoinstance->dsa_method->pubkey_gen) {
            ret = l_cryptoinstance->dsa_method->pubkey_gen(vce_id, l_cryptoinstance->dsa_p, l_cryptoinstance->dsa_g, dsakey->priv_key, dsakey->pub_key);
        }
    }

    return ret;
}
